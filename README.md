# dump-vk-group
Скрипт для создания дампа группы вк (организованная, сортированная копия всех материалов со стены).
Создавался для личных целей, умеет не всё, имеет несовершенства, возможно потребует доработки для каких-то задач. Тем не менее, может быть использован как готовая основа.
Используя дамп, можно нехитрым скриптом перенести группу в другую социалочку, [рабочий пример](https://t.me/private169)
 
Сохраняет тексты, аудио (в обход блокировки API) и картинки (включая картинки-документы: GIF и жпеги без сжатия).
Не включает репосты, не умеет обрабатывать новые "альбомы на стене", игнорирует видео, объекты-ссылки и всё прочее.

Создаёт директорию с ID группы вместо имени и следующей структурой:
```
- wall.txt
- attachments/
    |> audio/
    |> photo/
- messages/
```

* **wall.txt** — JSON объект, содержащий некоторые метаданные постов в следующем формате:
```json
"id_поста": {
  'unix_date': "дата поста в формате unixtime",
  'from': "автор (для большинства групп её собственный ID)",
  'text': "текст поста",
  'likes': "количество лайков",
  'reposts': "количество репостов",
  'views': "количество просмотров"
}
```
* audio, photo — содержат директории, соответствующие ID поста, вложения к которому они содержат.
Например, в wall.txt есть данные о посте с ID 3, тогда в attachments/audio/3/ есть mp3 файлы, которые были приложены к посту.
Если в посте не было вложений такого типа, то папки не будет.
* messages/ — содержит txt-файлы, соответствующие ID человека, с которым вёлся диалог от имени группы. Формат:

```json
{
  "name": "имя",
  "surname": "фамилия",
  "peer_id": "ID получателя",
  "messages": […(массив с метаданными сообщений, формат как в документации VK)…]
}
```

## Установка
Зависимости можно установить так:
```
pip install vk_api vkaudiotoken
```

## Использование
В директории со скриптом main.py создайте файл config.txt и внесите три строчки с логином от вк, паролем и ID нужной группы (соблюдая очерёдность), например так:
```
+78005553535
password
1
```
Если нужен дамп переписки, то четвёртой строкой допишите [токен сообщества с правом на доступ к сообщениям](https://vk.com/dev/bots_docs?f=1.1.%20%D0%9F%D0%BE%D0%BB%D1%83%D1%87%D0%B5%D0%BD%D0%B8%D0%B5%20%D0%BA%D0%BB%D1%8E%D1%87%D0%B0%20%D0%B4%D0%BE%D1%81%D1%82%D1%83%D0%BF%D0%B0)

Если группа закрытая или частная, то необходимо, чтобы аккаунт, данные которого вы предоставляете, имел к ней доступ (для постов хватит членства,
для сообщений нужны права админа)

В качестве аргументов-ключей допустимы следующие значения:
```
--messages --photo --audio
```
Используя их, можно выбрать, что нужно дампить.

Скачать только сообщения, без аудио и фото:
```
python main.py --messages
```

Аудио и фото без сообщений:
```
python main.py --audio --photo
```

При запуске без аргументов задампится **всё**.

Скрипт будет кратко сообщать, что он делает в данный момент.

Обратите внимание, что дампер создан с Linux в голове. Для работы в Windows, возможно, придётся кое-что поправить *(например, реализацию загрузок в save_audio по аналогии с save_docs)*

## Contribution и использование кода
Pull requests с доработками принимаются

Репозиторий распространяется по GNU GPLv3, можно свободно использовать его
для построения других проектов, например более функционального дампера